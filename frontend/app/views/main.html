<div class="container-fluid">

  <div class="row">
    <div class="col-md-2">

      <!-- project select -->
      <div class="btn-group" uib-dropdown>
        <button id="single-button" type="button" class="btn btn-default" uib-dropdown-toggle>
          Project: {{selectedProject ? selectedProject.name : "(Select)"}} <span class="caret"></span>
        </button>
        <ul uib-dropdown-menu role="menu" aria-labelledby="single-button">
          <li role="menuitem" ng-repeat="project in projects">
            <a href ng-click="selectProject(project)">
              {{project.name}}
              <button class="btn btn-danger menu-remove btn-xs" type="button">
                <span class="glyphicon glyphicon-remove" ng-click="removeProject($event, project, $index)" aria-hidden="true"></span>
              </button>
            </a>
          </li>
          <li class="divider"></li>
          <li role="menuitem">
            <a href>
              <form role="form" ng-submit="addProject()">
                <div class="row">
                  <div class="input-group input-group-sm">
                    <input type="text" ng-model="newProjectName" class="form-control" placeholder="New project..." ng-click="preventDefault($event)">
                    <span class="input-group-btn">
                      <button class="btn btn-primary" type="submit" ng-click="addProject()">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                      </button>
                    </span>
                  </div>
                </div>
              </form>
            </a>
          </li>
        </ul>
      </div>

      <!-- dataset upload -->
      <div ng-show="selectedProject">
        <br>
        <div class="list-group">
          <a href="#" class="list-group-item {{d === selectedDataset ? 'active' : ''}}" ng-repeat="d in datasets" ng-click="selectDataset(d, $index, $event)">
            <span class="badge">{{d.count}}</span>
            {{d.name}}
          </a>
        </div>
        <uib-progressbar max="100" value="uploadProgress" ng-show="uploadProgress >= 0 && uploadProgress < 100"><span>{{uploadProgress}}%</span></uib-progressbar>
        <uib-alert ng-repeat="alert in alerts" type="{{alert.type}}" close="closeAlert($index)">{{alert.message}}</uib-alert>
        <div class="btn-group-vertical" role="toolbar">
          <div class="btn btn-primary" ngf-select="uploadFiles($files)" multiple
            accept="text/csv">Upload CSV...
          </div>
          <div class="btn btn-danger" role="group" ng-show="selectedDataset" ng-click="deleteDataset()">Delete</div>
          <div class="btn btn-default" role="group" ng-show="selectedDataset" ng-click="profileDataset()">Profile</div>
          <div class="btn btn-default" role="group" ng-show="selectedDataset" ng-click="resetDatasetWidgets()">Reset widgets</div>
        </div>
      </div>

    </div>

    <div class="col-md-10">

      <div ui-grid="datasetGrid" __ui-grid-auto-resize ui-grid-pagination class="datasetGrid" ng-if="selectedDataset"></div>
      <div ng-show="loadingData">Loading...</div>

      <div gridster="gridsterOpts">
        <ul>
          <li gridster-item="widget" ng-repeat="widget in selectedDataset.widgets" ng-if="toggleWidget(widget)">
            <div class="box">
              <div class="box-header">
                <h4>{{widget.title || 'Widget ' + $index}}</h4>
                <div class="box-header-btns pull-right">
                  <a title="Remove widget" ng-click="removeWidget(widget, $index)"><i class="glyphicon glyphicon-trash"></i></a>
                </div>
              </div>
              <div class="box-content" ng-switch on="widget.type" style="height: {{widgetContentHeight(widget)}}px;">
                <div ng-switch-when="data">
                </div>
                <div ng-switch-when="raw">
                  data here
                </div>
                <div ng-switch-when="datatypes">
                  <div class="box-content-actions-header">
                    <span class="box-content-actions-label">
                    {{selectedDataset.results.messystreams.length}} columns
                    </span>
                    <span class="box-content-actions-label">Show:</span>
                    <span class="{{selectedOptionClass(widget.vizType, 'list')}}" ng-click="toggleWidgetOption(widget, 'vizType', 'list')">List</span>
                    <span class="{{selectedOptionClass(widget.vizType, 'chart')}}" ng-click="toggleWidgetOption(widget, 'vizType', 'chart')">Chart</span>
                  </div>
                  
                  <div ng-if="widget.vizType === 'list'" class="list-group">
                    <a class="list-group-item" href="#"
                    ng-repeat="result in selectedDataset.results.messystreams"
                    title="{{datatypeHasHistogram(result) ? 'Show histogram' : ''}}"
                    ng-click="datatypeClicked($event, result)">
                      <span class="badge messystreams-badge-{{type.name}}"
                      ng-repeat="type in result.types">
                      {{type.name}}{{type.count == selectedDataset.count ? '' : ": " + type.count + " (" + type.percentage + "%)"}}
                      </span>
                      {{result.key}}
                    </a>
                  </div>

                  <div ng-if="widget.vizType === 'chart'">
                    <highchart id="chart_{{selectedDataset.id}}_datatypes_{{$index}}" config="widget.chartConfig"></highchart>
                  </div>

                </div>

                <div ng-switch-when="histogram">
                  <div class="box-content-actions-header">
                    <span class="box-content-actions-label">
                    {{selectedDataset.histograms[widget.key][widget.datatype].value.length}} values
                    </span>
                    <span class="box-content-actions-label">Show:</span>
                    <span class="{{selectedOptionClass(widget.vizType, 'list')}}" ng-click="toggleWidgetOption(widget, 'vizType', 'list')">Top 20</span>
                    <span class="{{selectedOptionClass(widget.vizType, 'chart')}}" ng-click="toggleWidgetOption(widget, 'vizType', 'chart')">Chart</span>
                    <span ng-if="widget.vizType === 'chart'">
                      <span class="box-content-actions-label">Sort by:</span>
                      <span class="{{selectedOptionClass(widget.sort, 'count')}}" ng-click="toggleWidgetOption(widget, 'sort', 'count')">Count</span>
                      <span class="{{selectedOptionClass(widget.sort, 'value')}}" ng-click="toggleWidgetOption(widget, 'sort', 'value')">Value</span>
                    </span>
                  </div>
                  
                  <div ng-if="widget.vizType === 'list'" class="list-group">
                    <a class="list-group-item"
                    ng-repeat="result in selectedDataset.histograms[widget.key][widget.datatype].count | orderBy:'-count' | limitTo:20 ">
                      <span class="badge">
                      {{result.count}} ({{result.count*100/selectedDataset.count | number:0}}%)
                      </span>
                      {{result.value}}
                    </a>
                  </div>

                  <div ng-if="widget.vizType === 'chart'">
                    <highchart id="chart_{{selectedDataset.id}}_{{$index}}" config="widget.chartConfig"></highchart>
                  </div>

                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>

    </div>

  </div>

</div>
